# 添加交互

良好的交互可以增加用户体验，那么我们可以加上交互。

- 首先为Activity添加一个碰撞事件，在Android中使用setOnTouchListener()监听视图，当用户触摸之后，就会由于一个onTouch事件。

  当用户触碰了那个视图之后，就会接收到一个onTouch();我们做的第一件事就是查看是否需要处理，在Android中，视图映射到左上角00，右下角等于视图的大小

  ```
  final float normalizedX = （event.getX()/(float)v.getWidth()）*-1;
  final float normalizedX = （event.getY()/(float)v.getHight()）*-1;
  ```

- 在Android中是-1到1之间，所以需要将其归一化之后，在进行操作。

  ```
  final float normalized = (X/width)*2-1  原因就是在中间为0,0点但是触摸屏是左上角，所以成2-1
  ```

- 转发触控事件给渲染器



- 添加一个事件，然后对其进行使用线程操作。因为主线程中的UI在运行，所以为了渲染，需要在另一个线程中进行，使用queueEvent分发线程。

  在Android中处理了某一个操作，就返回一个true，如果返回false或者是null,就表示未执行。

- 相交测试：我们已经检测到了触摸，但是这个使用事务触摸到了某个物体呢。下来就需要相交测试。

  将二维的转换为三维的，这个时候需要知道到底触摸到了什么，从触摸点做出一条射线。

  检测这个射线是否与物体相交【之前的触摸是，无论摸到什么都进行旋转等】

  **做法：**

  ​	使用一个变量存储是否将物体按住，

  ​	存储物体的位置。他被初始化一个值。

- 将触摸点与物体相交，将触摸投影到一条直线上，使用一个球装那个物体。

  （1）将二维 点转为三维的点，一个在近端一个在远端，我们画一条射线，将二维变为三维。

  二维到三维使用的是透视除法和透视投影。现在的做法就是将二维在三维里面相对应。也就是取消投影。

  （2）我们将触摸点放到一个直线上。所以需要一个反转矩阵。

  ```
  private final float[] invertedViewProjectionMatrix = new float[16];
  在DrawFrame中，加入一行invert(pr,0,viewpro,0) 将二维转化为三维。
  ```

  

  

- 