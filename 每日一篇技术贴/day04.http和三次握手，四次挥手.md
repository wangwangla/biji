# 三次握手，四次挥手
```
```
## 三次握手
```
    首先客户端发送请求报文，server接受连接后进行回复报文，并为这次通信分配资源，客户端收到之后，也会向服务器发送报文，并分配资源，这样一条TCP就连接了。

    客户端--》服务端--》客户端--》服务端     

    客户端发送一个请求，服务器端应答请求，并为本次提供资源，客户端收到这个响应，并为这次连接分配资源，并发数报文。

```
## 四次挥手
```

    发送断开的可以是客户端，也可以是服务端。
    假如客户端首先发送中断报文，服务器收到断开报文，然后服务器对客户端进行响应，这个时候客户端进入到等待状态。
    如果服务器端无报文发送，那么就会发送一个报文，客户端收到报文之后，就可以关闭连接了。
    然后给服务端响应一个报文，如果服务器没有收到，那么就会重传，等到两秒服务器端无回复，那么就知道服务器端已经关闭了，然后客户端也关闭了。

    【问题1】为什么连接的时候是三次握手，关闭的时候却是四次握手？
    答：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，"你发的FIN报文我收到了"。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。

    【问题2】为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？
    答：虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。


======================================================================================================
```
# http协议
```
